{% extends "layout.html" %}

{% block title %}
AI YouTube Script Writer
{% endblock title %}

{% block content %}
<div class="container-fluid">
    <div class="row">

        <!-- Sidebar -->
        <div class="col-md-2">
            <div class="card border-0 shadow-sm mb-3">
                <div class="card-body">
                    <form action="{{ url_for('chats.new_chat') }}" method="post">
                        <button type="submit" class="btn btn-outline-dark  text-bold"><strong>New Chat</strong></button>
                        </form>
                </div>
            </div>

            <!-- Saved Scripts -->
            <div class="bg-light border-end vh-100 p-3 overflow-auto">
                <h5>My Saved Scripts</h5>
                <ul class="list-group">
                    {% for chat in chats %}
                    <li class="list-group-item d-flex justify-content-between align-items-center {% if selected_chat and chat.id == selected_chat.id %}active{% endif %}">
                        <a href="{{ url_for('chats.view_chat', chat_id=chat.id) }}" class="text-decoration-none flex-grow-1">
                            {{ chat.title }}
                        </a>

                        <!-- Trash button -->
                        <form action="{{ url_for('chats.delete_chat', chat_id=chat.id) }}" method="post" class="m-0 p-0" onsubmit="return confirm('Are you sure?');">
                            <button type="submit" class="btn btn-sm btn-outline-secondary p-1 m-0 border-0">
                                <i class="bi bi-trash"></i>
                            </button>
                        </form>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Main Content -->
        <div class="col-md-10">
            <div class="shadow-sm p-4 mb-5 bg-body-tertiary rounded">
                <h1>AI YouTube Script Writer</h1>
                <h3>Generate viral video scripts in seconds using the power of Google Gemini.</h3>

                <!-- Prompt Form -->
                <form action="/" method="POST">
                    <div class="mb-3">
                        <h5>What is your video about?</h5>
                        <textarea name="user_input" rows="4" class="form-control"
                                  placeholder="e.g., Top 10 places to visit in Japan"></textarea>
                    </div>
                    <button type="submit" class="btn btn-outline-dark">Generate Script</button>
                </form>

                <hr>

                <!-- Generated Script Section -->
                {% if generated_script %}

                <!-- Header: Title on Left, Button on Right -->
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h3 class="mb-0">Your Script</h3>

                    <!-- THE COPY BUTTON -->
                    <button onclick="copyToClipboard()" class="btn btn-outline-primary btn-sm" id="copyBtn">
                        <i class="bi bi-clipboard"></i> Copy to Clipboard
                    </button>
                </div>

                <!-- The Script Text Container -->
                <div id="scriptContent" class="p-3 bg-white border rounded" style="white-space: pre-wrap;">{{ generated_script | safe }}</div>

                {% endif %}
            </div>
        </div>

    </div>
</div>

<!-- JAVASCRIPT FOR COPY FUNCTIONALITY -->
<script>
    function copyToClipboard() {
        // 1. Find the text inside the div with id="scriptContent"
        var text = document.getElementById("scriptContent").innerText;

        // 2. Command the browser to write it to clipboard
        navigator.clipboard.writeText(text).then(function () {

            // 3. Get the button
            var btn = document.getElementById("copyBtn");

            // 4. Change button look to "Success/Green"
            btn.innerHTML = '<i class="bi bi-check-lg"></i> Copied!';
            btn.classList.remove('btn-outline-primary');
            btn.classList.add('btn-success');

            // 5. Reset button back to normal after 2 seconds
            setTimeout(function () {
                btn.innerHTML = '<i class="bi bi-clipboard"></i> Copy to Clipboard';
                btn.classList.remove('btn-success');
                btn.classList.add('btn-outline-primary');
            }, 2000);
        });
    }
</script>

{% endblock content %}